<!DOCTYPE html>
<html lang="en-us">

    <head>

        <title>Dep使用记录</title>

        <style>

    html body {
        font-family: Noto Sans, sans-serif;
        background-color: white;
    }

    :root {
        --accent: black;
        --border-width:  5px ;
    }

</style>


<link rel="stylesheet" href="https://tsunami42.github.io/blog/css/main.css">





<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto%20Sans">


 <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css"> 


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">


<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
 


    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

     <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/shell.min.js"></script> 

    <script>hljs.initHighlightingOnLoad();</script>







<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>


<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
 <meta name="generator" content="Hugo 0.25.1" />

        <meta charset="utf-8">

        <meta name="viewport" content="width=device-width, initial-scale=1">

    </head>

    <body>

        <nav class="navbar navbar-default navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">

                    <a class="navbar-brand visible-xs" href="#">Dep使用记录</a>

                    <button class="navbar-toggle" data-target=".navbar-collapse" data-toggle="collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>

                </div>

                <div class="collapse navbar-collapse">

                    
                        <ul class="nav navbar-nav">
                            
                                <li><a href="https://tsunami42.github.io/blog/">Home</a></li>
                            
                                <li><a href="https://tsunami42.github.io/blog/posts/">Posts</a></li>
                            
                        </ul>
                    

                    
                        <ul class="nav navbar-nav navbar-right">
                            
                                <li class="navbar-icon"><a href="https://github.com/tsunami42/"><i class="fa fa-github"></i></a></li>
                            
                                <li class="navbar-icon"><a href="https://twitter.com/_Tsunami_42_/"><i class="fa fa-twitter"></i></a></li>
                            
                        </ul>
                    

                </div>

            </div>

        </nav>


<main>

    <div class="item">

    
    

    
    

    <h4><a href="https://tsunami42.github.io/blog/posts/dep-usage/">Dep使用记录</a></h4>
    <h5>August 4, 2017</h5>
    

</div>


    <br> <div class="text-justify">

<h1 id="dep介绍">dep介绍</h1>

<p>今年GopherCon刚好有两个关于dep的talk</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=5LtMb090AZI&amp;list=PL2ntRZ1ySWBdD9bru6IR-_WXUgJqvrtx9&amp;index=18">The New Era of Go Package Management</a></li>
<li><a href="https://www.youtube.com/watch?v=eZwR8qr2BfI&amp;list=PL2ntRZ1ySWBfhRZj3BDOrKdHzoafHsKHU&amp;index=16">go dep in 10 minutes</a></li>
</ul>

<h1 id="使用方法">使用方法</h1>

<pre><code class="language-shell">$ dep init
</code></pre>

<p>初始化项目，会先从已有的包管理读取配置依赖信息（<code>glide</code> &amp; <code>godep</code>），备份当前的<code>vendor/</code>然后生成相应的文件 <a href="https://github.com/golang/dep/blob/master/docs/Gopkg.toml.md"><code>Gopkg.toml</code></a> 与<code>Gopkg.lock</code>，最后将依赖安装到<code>vendor/</code>目录下</p>

<pre><code class="language-shell">$ dep ensure
</code></pre>

<p>保证<code>vendor/</code>目录下的依赖符合<code>Gopkg.toml</code>与<code>Gopkg.lock</code>中的配置，如果没有就创建目录</p>

<h1 id="使用时的坑">使用时的坑</h1>

<p>我的项目有两个依赖：</p>

<ul>
<li><code>github.com/influxdata/influxdb@v1.0.0</code><br /></li>
<li><code>github.com/Shopify/sarama@v1.12.0</code><br /></li>
</ul>

<p>原先是通过gdm来直接保存和修改GOPATH中包的版本信息，没有使用vendor的功能，所有的信息都直接从src目录下代码的版本号获得</p>

<p>在执行<code>dep init</code>后， <code>Gopkg.toml</code>里influxdb的依赖一直不对，一直是当前最大的tag，v1.3.1，多次尝试后，通过<code>dep help init</code>找到了答案</p>

<pre><code>$ dep help init
...
By default, the dependencies are resolved over the network. A version will be
selected from the versions available from the upstream source per the following
algorithm:
 - Tags conforming to semver (sorted by semver rules)
 - Default branch(es) (sorted lexicographically)
 - Non-semver tags (sorted lexicographically)
An alternate mode can be activated by passing -gopath. In this mode, the version
of each dependency will reflect the current state of the GOPATH. If a dependency
doesn't exist in the GOPATH, a version will be selected based on the above
network version selection algorithm.
...
</code></pre>

<p>默认情况下，<code>dep init</code>是直接从网上获取版本信息，只有指定了<code>-gopath</code>，才是从当前的GOPATH中获取。</p>
</div>

    
    

    

</main>



        <footer>

            <p class="copyright text-muted">&copy; All rights reserved. Powered by <a href="https://gohugo.io">Hugo</a> and <a href="https://github.com/calintat/minimal">Minimal</a></p>

        </footer>

    </body>

</html>

